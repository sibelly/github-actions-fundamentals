name: Create production promotion pull request

on:
  push:
    branches:
      - 'hotfix/*'  # Trigger for hotfix branches
    workflow_dispatch:

jobs:
  promote-hotfix:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Verify if PR already open
      id: pr-check
      env:
        GH_TOKEN: ${{ secrets.PAT }}
      run: |
        prs_list=$(gh pr list --search "${{ github.ref_name }}")
        echo "${prs_list}"
        if [ -n "$prs_list" ]; then
          echo "PR already opened"
          echo "pr_exists=true" >> $GITHUB_OUTPUT  # Using GITHUB_OUTPUT for setting output
        else
          echo "pr_exists=false" >> $GITHUB_OUTPUT  # Using GITHUB_OUTPUT for setting output
        fi

    - name: Create pull request
      if: steps.pr-check.outputs.pr_exists == 'false'  # Only run if no PR exists
      run: gh pr create -B main -H ${{ github.ref_name }} --title 'Merge ${{ github.ref_name }} into main' --body 'Created by Github action'
      env:
        GITHUB_TOKEN: ${{ secrets.PAT }}